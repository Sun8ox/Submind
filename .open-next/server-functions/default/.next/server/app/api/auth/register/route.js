(()=>{var e={};e.id=612,e.ids=[612],e.modules={479:(e,s,t)=>{"use strict";function r(e){return"string"!=typeof e?{success:!1,message:"Password must be a string"}:/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]{8,}$/.test(e)?{success:!0}:{success:!1,message:"Password must be at least 8 characters long and contain at least one letter and one number"}}function a(e){return"string"!=typeof e?{success:!1,message:"Email must be a string"}:/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(e)?{success:!0}:{success:!1,message:"Email is not valid"}}function n(e){return"string"!=typeof e?{success:!1,message:"Username must be a string"}:/^[a-zA-Z0-9_]{3,20}$/.test(e)?{success:!0}:{success:!1,message:"Username must be between 3 and 20 characters long and can only contain letters, numbers, and underscores"}}function u(e){try{if(isNaN(e)||e<=0)return{success:!1,message:"ID must be a positive number"};if(!Number.isInteger(Number(e)))return{success:!1,message:"ID must be an integer"};return{success:!0}}catch(e){return{success:!1,message:"Invalid ID"}}}function i(e,s=1,t=1e3){return e&&"string"!=typeof e?{success:!1,message:"Description must be a string"}:e&&0===e.trim().length?{success:!1,message:"Text cannot be empty"}:e.length<s||e.length>t?{success:!1,message:"Text must be between "+s+" and "+t+" characters"}:/<[^>]+>/.test(e)?{success:!1,message:"Text contains invalid characters"}:{success:!0}}t.d(s,{DT:()=>a,GZ:()=>u,Oj:()=>r,Ok:()=>i,TU:()=>n})},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5511:e=>{"use strict";e.exports=require("crypto")},6487:()=>{},6536:(e,s,t)=>{"use strict";t.d(s,{EJ:()=>o,JE:()=>u,LD:()=>m,VJ:()=>c,ht:()=>n,kl:()=>a,lq:()=>l,wg:()=>i});let r=(0,t(8909).lw)(process.env.DATABASE_URL);async function a(e){return(await r.query("SELECT * FROM auth.users WHERE id = $1 LIMIT 1;",[e]))[0]||null}async function n(e){return(await r.query("SELECT * FROM auth.users WHERE email = $1 LIMIT 1;",[e]))[0]||null}async function u(e){return(await r.query("SELECT * FROM auth.users WHERE username = $1 LIMIT 1;",[e]))[0]||null}async function i(e,s){return(await r.query("UPDATE auth.users SET password = $1 WHERE id = $2 RETURNING *;",[s,e]))[0]||null}async function c(e="",s=""){let t=await r.query("SELECT * FROM auth.users WHERE username = $1 OR email = $2 LIMIT 1;",[e,s]);return 0!==t.length&&{usernameExists:t[0].username===e,emailExists:t[0].email===s}}async function o(e,s,t){return(await r.query("INSERT INTO auth.users (username, email, password) VALUES ($1, $2, $3) RETURNING *;",[e,s,t]))[0]||null}async function l(e,s){return(await r.query("INSERT INTO auth.verification (userid, token) VALUES ($1, $2) RETURNING *;",[e,s]))[0]||null}async function m(e,s){let t=await r.query("SELECT * FROM auth.verification WHERE userid = $1 LIMIT 1;",[s]);if(0===t.length)return!1;let a=t[0];return console.log(a),console.log(e),String(a.token).trim()===String(e).trim()&&(await r.query("DELETE FROM auth.verification WHERE userid = $1;",[s]),await r.query("UPDATE auth.users SET verified = true WHERE id = $1;",[s]),!0)}},7280:(e,s,t)=>{"use strict";t.r(s),t.d(s,{patchFetch:()=>f,routeModule:()=>m,serverHooks:()=>p,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>g});var r={};t.r(r),t.d(r,{POST:()=>l});var a=t(6559),n=t(8088),u=t(7719),i=t(2190),c=t(8709),o=t(479);async function l(e){try{let{username:s,email:t,password:r,passwordAgain:a}=await e.json();if(!s||!t||!r||!a)return i.NextResponse.json({success:!1,message:"All fields are required"},{status:400});if(r!==a)return i.NextResponse.json({success:!1,message:"Passwords do not match"},{status:400});let{success:n,message:u}=(0,o.TU)(s);if(!n)return i.NextResponse.json({success:!1,message:u},{status:400});let{success:l,message:m}=(0,o.DT)(t);if(!l)return i.NextResponse.json({success:!1,message:m},{status:400});let{success:d,message:g}=(0,o.Oj)(r);if(!d)return i.NextResponse.json({success:!1,message:g},{status:400});let p=await (0,c.DY)({username:s,email:t,password:r});if(!1===p.success)return i.NextResponse.json({success:!1,message:p.message},{status:500});if(!1===p.token)return i.NextResponse.json({success:!1,message:"Failed to create authentication token"},{status:500});let f=i.NextResponse.json({success:!0,message:"Registration successful. Please check your email for verification."},{status:201});return f.cookies.set("Submind.AuthToken",p.token,{httpOnly:!0,secure:!0,sameSite:"strict",maxAge:86400}),f}catch(e){return console.error("Registration error:",e),i.NextResponse.json({error:"Registration failed"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"/Users/sun8ox/Programming/VisualStudioCode/Websites/submind/src/app/api/auth/register/route.js",nextConfigOutput:"standalone",userland:r}),{workAsyncStorage:d,workUnitAsyncStorage:g,serverHooks:p}=m;function f(){return(0,u.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:g})}},7910:e=>{"use strict";e.exports=require("stream")},8335:()=>{},8354:e=>{"use strict";e.exports=require("util")},8709:(e,s,t)=>{"use strict";t.d(s,{$u:()=>m,ec:()=>d,ri:()=>g,DY:()=>l,k9:()=>o});var r=t(5663),a=t(6536),n=t(3205),u=t.n(n),i=t(2190);let c=process.env.JWT_SECRET;if(!c)throw Error("JWT_SECRET is not defined");async function o(e){try{let s=u().verify(e,c);if(!s||!s.id)return{success:!1,message:"Invalid token"};return{success:!0,userId:s.id}}catch(e){return console.error("Token validation error:",e),{success:!1,message:"Invalid token"}}}async function l(e){try{let{email:s,username:t,password:n}=e;if(!s||!t||!n)return{success:!1,message:"Email, username and password are required"};let i=(0,a.VJ)(t,s);if(i.usernameExists)return{success:!1,message:"Username already exists"};if(i.emailExists)return{success:!1,message:"Email already exists"};let o=await r.Ay.hash(n,10),l=await (0,a.EJ)(t,s,o);if(!l||!l.id)return{success:!1,message:"Failed to register user"};let m=l.id,d=Math.floor(899999*Math.random()+1e5),g=await (0,a.lq)(m,d);if(!g)return{success:!1,message:"Failed to create verification token"};let p=g.token,f=(console.log(`Sending verification email to ${s} with token ${p}`),{success:!0,message:"Feature not implemented yet, sending to console"});if(!f.success)return{success:!1,message:"Failed to send verification email"};let h=u().sign({id:m},c,{expiresIn:"7d"});if(!h)return{success:!1,message:"Failed to create authentication token"};return{success:!0,message:"Registration successful. "+f.message,token:h}}catch(e){return console.error("Registration error:",e),{success:!1,message:"Registration failed"}}}async function m(e){try{let{email:s,username:t,password:n}=e;if(!s&&!t)return{success:!1,message:"Email or username is required"};let i=t?await (0,a.JE)(t):await (0,a.ht)(s);if(!i)return{success:!1,message:"User not found"};if(!await r.Ay.compare(n,i.password))return{success:!1,message:"Invalid username or password"};let o=u().sign({id:i.id},c,{expiresIn:"7d"});return{success:!0,message:"Authentication successful",token:o}}catch(e){return console.error("Authentication error:",e),{success:!1,message:"Authentication failed"}}}async function d(e,s,t){try{let n=await (0,a.kl)(e);if(!n)return{success:!1,message:"User not found"};if(!await r.Ay.compare(s,n.password))return{success:!1,message:"Old password is incorrect"};if(await r.Ay.compare(t,n.password))return{success:!1,message:"New password cannot be the same as the old password"};let u=await r.Ay.hash(t,10);if(!await (0,a.wg)(e,u))return{success:!1,message:"Failed to update password"};return{success:!0,message:"Password changed successfully"}}catch(e){return console.error("Error changing password:",e),{success:!1,message:"Failed to change password"}}}function g(e){let s=i.NextResponse.redirect(new URL("/",e.url));return s.cookies.set("Submind.AuthToken","",{maxAge:-1}),s}},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9428:e=>{"use strict";e.exports=require("buffer")}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[719,660],()=>t(7280));module.exports=r})();