(()=>{var e={};e.id=831,e.ids=[831],e.modules={497:(e,s,r)=>{"use strict";r.r(s),r.d(s,{patchFetch:()=>g,routeModule:()=>c,serverHooks:()=>m,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>d});var t={};r.r(t),r.d(t,{GET:()=>o});var a=r(6559),n=r(8088),i=r(7719),u=r(8709);function o(e){return(0,u.ri)(e)}let c=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/logout/route",pathname:"/logout",filename:"route",bundlePath:"app/logout/route"},resolvedPagePath:"/Users/sun8ox/Programming/VisualStudioCode/Websites/submind/src/app/logout/route.js",nextConfigOutput:"standalone",userland:t}),{workAsyncStorage:l,workUnitAsyncStorage:d,serverHooks:m}=c;function g(){return(0,i.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:d})}},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5511:e=>{"use strict";e.exports=require("crypto")},6487:()=>{},6536:(e,s,r)=>{"use strict";r.d(s,{EJ:()=>c,JE:()=>i,LD:()=>d,VJ:()=>o,ht:()=>n,kl:()=>a,lq:()=>l,wg:()=>u});let t=(0,r(8909).lw)(process.env.DATABASE_URL);async function a(e){return(await t.query("SELECT * FROM auth.users WHERE id = $1 LIMIT 1;",[e]))[0]||null}async function n(e){return(await t.query("SELECT * FROM auth.users WHERE email = $1 LIMIT 1;",[e]))[0]||null}async function i(e){return(await t.query("SELECT * FROM auth.users WHERE username = $1 LIMIT 1;",[e]))[0]||null}async function u(e,s){return(await t.query("UPDATE auth.users SET password = $1 WHERE id = $2 RETURNING *;",[s,e]))[0]||null}async function o(e="",s=""){let r=await t.query("SELECT * FROM auth.users WHERE username = $1 OR email = $2 LIMIT 1;",[e,s]);return 0!==r.length&&{usernameExists:r[0].username===e,emailExists:r[0].email===s}}async function c(e,s,r){return(await t.query("INSERT INTO auth.users (username, email, password) VALUES ($1, $2, $3) RETURNING *;",[e,s,r]))[0]||null}async function l(e,s){return(await t.query("INSERT INTO auth.verification (userid, token) VALUES ($1, $2) RETURNING *;",[e,s]))[0]||null}async function d(e,s){let r=await t.query("SELECT * FROM auth.verification WHERE userid = $1 LIMIT 1;",[s]);if(0===r.length)return!1;let a=r[0];return console.log(a),console.log(e),String(a.token).trim()===String(e).trim()&&(await t.query("DELETE FROM auth.verification WHERE userid = $1;",[s]),await t.query("UPDATE auth.users SET verified = true WHERE id = $1;",[s]),!0)}},7910:e=>{"use strict";e.exports=require("stream")},8335:()=>{},8354:e=>{"use strict";e.exports=require("util")},8709:(e,s,r)=>{"use strict";r.d(s,{$u:()=>d,ec:()=>m,ri:()=>g,DY:()=>l,k9:()=>c});var t=r(5663),a=r(6536),n=r(3205),i=r.n(n),u=r(2190);let o=process.env.JWT_SECRET;if(!o)throw Error("JWT_SECRET is not defined");async function c(e){try{let s=i().verify(e,o);if(!s||!s.id)return{success:!1,message:"Invalid token"};return{success:!0,userId:s.id}}catch(e){return console.error("Token validation error:",e),{success:!1,message:"Invalid token"}}}async function l(e){try{let{email:s,username:r,password:n}=e;if(!s||!r||!n)return{success:!1,message:"Email, username and password are required"};let u=(0,a.VJ)(r,s);if(u.usernameExists)return{success:!1,message:"Username already exists"};if(u.emailExists)return{success:!1,message:"Email already exists"};let c=await t.Ay.hash(n,10),l=await (0,a.EJ)(r,s,c);if(!l||!l.id)return{success:!1,message:"Failed to register user"};let d=l.id,m=Math.floor(899999*Math.random()+1e5),g=await (0,a.lq)(d,m);if(!g)return{success:!1,message:"Failed to create verification token"};let p=g.token,E=(console.log(`Sending verification email to ${s} with token ${p}`),{success:!0,message:"Feature not implemented yet, sending to console"});if(!E.success)return{success:!1,message:"Failed to send verification email"};let f=i().sign({id:d},o,{expiresIn:"7d"});if(!f)return{success:!1,message:"Failed to create authentication token"};return{success:!0,message:"Registration successful. "+E.message,token:f}}catch(e){return console.error("Registration error:",e),{success:!1,message:"Registration failed"}}}async function d(e){try{let{email:s,username:r,password:n}=e;if(!s&&!r)return{success:!1,message:"Email or username is required"};let u=r?await (0,a.JE)(r):await (0,a.ht)(s);if(!u)return{success:!1,message:"User not found"};if(!await t.Ay.compare(n,u.password))return{success:!1,message:"Invalid username or password"};let c=i().sign({id:u.id},o,{expiresIn:"7d"});return{success:!0,message:"Authentication successful",token:c}}catch(e){return console.error("Authentication error:",e),{success:!1,message:"Authentication failed"}}}async function m(e,s,r){try{let n=await (0,a.kl)(e);if(!n)return{success:!1,message:"User not found"};if(!await t.Ay.compare(s,n.password))return{success:!1,message:"Old password is incorrect"};if(await t.Ay.compare(r,n.password))return{success:!1,message:"New password cannot be the same as the old password"};let i=await t.Ay.hash(r,10);if(!await (0,a.wg)(e,i))return{success:!1,message:"Failed to update password"};return{success:!0,message:"Password changed successfully"}}catch(e){return console.error("Error changing password:",e),{success:!1,message:"Failed to change password"}}}function g(e){let s=u.NextResponse.redirect(new URL("/",e.url));return s.cookies.set("Submind.AuthToken","",{maxAge:-1}),s}},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9428:e=>{"use strict";e.exports=require("buffer")}};var s=require("../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[719,660],()=>r(497));module.exports=t})();